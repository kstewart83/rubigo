---
description: Start isolated work in a git worktree for multi-agent development
---

# Start WIP (Work In Progress)

This workflow creates an isolated workspace for development without disturbing the main branch.

## Usage

- `/wip` - Start interactive dialogue to gather requirements
- `/wip <description>` - Include context upfront (e.g., `/wip I want to fix the sidebar bug`)

## Step 1: Understand the Goal

Before creating the worktree, determine:

1. **What type of work is this?**
   - `feature/` - New functionality
   - `bugfix/` - Fixing broken behavior
   - `docs/` - Documentation only
   - `chore/` - Maintenance, deps, tooling

2. **What is a concise slug for this work?** (e.g., `add-personnel-search`, `fix-sidebar-collapse`)

> [!TIP]
> For `feature/` work, consider using the `/req` workflow first to document requirements before creating the worktree.

## Step 2: Confirm Plan with User

Present the proposed:
- Branch name: `<type>/<slug>`
- Worktree path: `wip/<slug>/`

Get user approval before proceeding.

## Step 3: Allocate Port Range

Each WIP worktree claims a 1000-port range to avoid conflicts with other worktrees.

1. **Scan existing WIP configs**:
   ```bash
   # Check for existing wip.toml files
   find wip -maxdepth 2 -name "wip.toml" 2>/dev/null
   ```

2. **Extract claimed port ranges** from each `wip.toml`:
   - Read `ports.base` value
   - That WIP owns ports `base` to `base + 999`

3. **Select new port range**:
   - Choose random base in range 10000-60000 (in increments of 1000)
   - Verify no overlap with existing claims
   - Valid bases: 10000, 11000, 12000, ..., 60000

## Step 4: Create Worktree

From the repo root:
```bash
git worktree add wip/<slug> -b <type>/<slug>
```

## Step 5: Generate wip.toml

Create `wip/<slug>/wip.toml` with the following structure:

```toml
# WIP Configuration - Auto-generated by /wip workflow
# This file is git-ignored and unique to this worktree

[worktree]
slug = "<slug>"
branch = "<type>/<slug>"
type = "<type>"
created_at = "<ISO 8601 timestamp>"

# GitHub PR number (set after first commit creates the PR)
# pr_number = 0

# Port range allocation
# This WIP owns ports <base> through <base + 999>
[ports]
base = <allocated_base>

# Reserved ports within the range
dev = <base>         # Development server
e2e = <base + 1>     # E2E test server
e2e_api = <base + 2> # E2E API server (if separate)
# Additional ports available: <base + 3> through <base + 999>

# Project-specific operational settings
[projects.rubigo-react]
database = "rubigo.db"
e2e_database = "rubigo-e2e.db"
validation_cmd = "bun run pre-push-check"
test_cmd = "bun run test:e2e:full"
version_file = "rubigo.toml"

[projects.blender-agent]
validation_cmd = "bun run lint"
test_cmd = "bun run test"
```

## Step 6: Begin Work

Work continues in `wip/<slug>/` using absolute paths. The main checkout remains untouched.

> [!NOTE]
> Each worktree uses its own database file in its own project directory. This isolation prevents SQLite lock conflicts between worktrees.

> [!TIP]
> If you need to run a dev server while another process (like E2E tests) might conflict, use `bun run dev:isolated` which uses a separate `.next-isolated` directory to avoid lock conflicts.

> [!IMPORTANT]
> The branch is NOT pushed until the first commit. Use `/wip-commit` to create checkpoint commits and push to remote.

## Related Workflows

| Workflow | Purpose |
|----------|---------|
| `/wip-commit` | Checkpoint commit, push, create/update PR |
| `/wip-merge` | Sync, validate, merge PR into main, cleanup |
| `/wip-delete` | Abandon work, close PR, cleanup worktree |

## Notes

- The `wip/` directory is git-ignored at the repo root
- The `wip.toml` file is git-ignored
- Multiple WIP workspaces can exist simultaneously
- Port ranges ensure no conflicts between concurrent dev servers

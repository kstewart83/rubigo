# ============================================================================
# RUBIGO ACCESS CONTROL - Requirements Ontology
# ============================================================================
# This file contains requirements for the Attribute-Based Access Control (ABAC)
# module, following the Requirements & Delivery Ontology.

[description]
overview = """
ACCESS CONTROL REQUIREMENTS
- Implements ABAC (Attribute-Based Access Control) for all platform data
- Three-dimensional access model: Sensitivity, Tenant, Role
- Dual-column schema: ACO (indexed) and SCO (metadata)
- Unified processing stack for all CRUD operations
- Comprehensive audit logging for all data access

This module ensures uniform data access control across the Rubigo platform,
laying the foundation for enterprise security posture.
"""

# ============================================================================
# OBJECTIVES - Strategic goals for access control
# ============================================================================

[[objectives]]
id = "obj-rubigo-access"
title = "Attribute-Based Access Control"
description = "The platform must enforce fine-grained access control where data visibility is determined by subject attributes (clearance, tenants, roles) evaluated against object attributes (sensitivity, tenants, required roles)"
project_id = "d4e5f6"
parent_id = "obj-it-security"
status = "active"

[[objectives]]
id = "obj-rubigo-sensitivity"
title = "Sensitivity Classification"
description = "All platform data must be classified by sensitivity level (public, low, moderate, high), and users must have appropriate clearance to access data at each level"
project_id = "d4e5f6"
parent_id = "obj-rubigo-access"
status = "active"

[[objectives]]
id = "obj-rubigo-tenants"
title = "Tenant Compartmentalization"
description = "Sensitive programs or compartments (represented by fruit emojis) can be assigned to data, and users must have specific tenant access at the appropriate sensitivity level"
project_id = "d4e5f6"
parent_id = "obj-rubigo-access"
status = "active"

[[objectives]]
id = "obj-rubigo-roles"
title = "Role-Based Access Constraints"
description = "Data can require specific roles for access, and users must possess all required roles to view or modify that data"
project_id = "d4e5f6"
parent_id = "obj-rubigo-access"
status = "active"

[[objectives]]
id = "obj-rubigo-audit"
title = "Comprehensive Access Audit"
description = "All data access operations (create, read, update, delete) must be logged with subject, object, action, and outcome for security auditing"
project_id = "d4e5f6"
parent_id = "obj-rubigo-access"
status = "active"

[[objectives]]
id = "obj-rubigo-classification"
title = "Classification Guidance"
description = "The platform must provide classification guides that help users understand how to correctly classify data by sensitivity, tenant, and role requirements"
project_id = "d4e5f6"
parent_id = "obj-rubigo-access"
status = "active"

# ============================================================================
# FEATURES - Capabilities that realize access control objectives
# ============================================================================

[[features]]
id = "feat-aco-schema"
name = "Access Control Object Schema"
description = "Every data table has an ACO (indexed JSON) and SCO (metadata JSON) column for access control"
objective_id = "obj-rubigo-access"
status = "planned"

[[features]]
id = "feat-sensitivity-levels"
name = "Sensitivity Level Enforcement"
description = "Users can only access data with sensitivity at or below their clearance level"
objective_id = "obj-rubigo-sensitivity"
status = "planned"

[[features]]
id = "feat-tenant-access"
name = "Tenant Compartment Enforcement"
description = "Users can only access data in tenants they have been granted access to at the appropriate level"
objective_id = "obj-rubigo-tenants"
status = "planned"

[[features]]
id = "feat-role-requirements"
name = "Role Requirement Enforcement"
description = "Users must have all required roles to access data that specifies role requirements"
objective_id = "obj-rubigo-roles"
status = "planned"

[[features]]
id = "feat-access-logging"
name = "Access Logging"
description = "All data access operations are logged with full context for audit purposes"
objective_id = "obj-rubigo-audit"
status = "planned"

[[features]]
id = "feat-classification-guides"
name = "Classification Guide Management"
description = "Administrators can create and manage classification guides that provide English-level descriptions of how to classify data"
objective_id = "obj-rubigo-classification"
status = "planned"

[[features]]
id = "feat-aco-modification"
name = "ACO Modification"
description = "Users can modify the access control settings of records they can access, within their clearance limits"
objective_id = "obj-rubigo-access"
status = "planned"

# ============================================================================
# RULES - User stories for access control features
# ============================================================================

# --- ACO Schema Rules ---

[[rules]]
id = "rule-aco-default"
feature_id = "feat-aco-schema"
role = "Platform System"
requirement = "assign a default ACO to every new record"
reason = "ensure no data is created without access control"
status = "draft"

[[rules]]
id = "rule-aco-explicit"
feature_id = "feat-aco-schema"
role = "Platform System"
requirement = "store each object's ACO explicitly (no inheritance)"
reason = "ensure access control is unambiguous and auditable"
status = "draft"

# --- Sensitivity Level Rules ---

[[rules]]
id = "rule-sensitivity-view"
feature_id = "feat-sensitivity-levels"
role = "Platform User"
requirement = "only see records with sensitivity at or below my clearance level"
reason = "prevent unauthorized access to sensitive information"
status = "draft"

[[rules]]
id = "rule-sensitivity-create"
feature_id = "feat-sensitivity-levels"
role = "Platform User"
requirement = "create records with sensitivity at or below my clearance level"
reason = "prevent escalation of data sensitivity beyond my authorization"
status = "draft"

[[rules]]
id = "rule-sensitivity-indicator"
feature_id = "feat-sensitivity-levels"
role = "Platform User"
requirement = "see a visual indicator of each record's sensitivity level"
reason = "understand the classification of data I'm viewing"
status = "draft"

# --- Tenant Access Rules ---

[[rules]]
id = "rule-tenant-access"
feature_id = "feat-tenant-access"
role = "Platform User"
requirement = "only see records in tenants I have access to at the appropriate level"
reason = "maintain compartmentalization of sensitive programs"
status = "draft"

[[rules]]
id = "rule-tenant-multi"
feature_id = "feat-tenant-access"
role = "Platform User"
requirement = "access records that require multiple tenants only if I have access to all of them"
reason = "enforce the principle of least privilege across compartments"
status = "draft"

[[rules]]
id = "rule-tenant-indicator"
feature_id = "feat-tenant-access"
role = "Platform User"
requirement = "see tenant indicators (fruit emojis) on records that are compartmentalized"
reason = "understand which sensitive programs protect the data"
status = "draft"

# --- Role Requirement Rules ---

[[rules]]
id = "rule-role-access"
feature_id = "feat-role-requirements"
role = "Platform User"
requirement = "only see records requiring roles I possess"
reason = "enforce function-based access control"
status = "draft"

[[rules]]
id = "rule-role-multi"
feature_id = "feat-role-requirements"
role = "Platform User"
requirement = "access records requiring multiple roles only if I have all specified roles"
reason = "ensure data is only visible to those with complete authorization"
status = "draft"

[[rules]]
id = "rule-global-admin"
feature_id = "feat-role-requirements"
role = "Global Administrator"
requirement = "bypass all access control checks"
reason = "administer the platform without restrictions"
status = "draft"

# --- Access Logging Rules ---

[[rules]]
id = "rule-log-all-reads"
feature_id = "feat-access-logging"
role = "Platform System"
requirement = "log every data read operation with subject, object, and timestamp"
reason = "maintain complete audit trail for security review"
status = "draft"

[[rules]]
id = "rule-log-writes"
feature_id = "feat-access-logging"
role = "Platform System"
requirement = "log every data write operation with subject, object, changes, and timestamp"
reason = "track all modifications for accountability"
status = "draft"

[[rules]]
id = "rule-log-denials"
feature_id = "feat-access-logging"
role = "Platform System"
requirement = "log every access denial with subject, attempted action, and reason"
reason = "detect potential security incidents and policy violations"
status = "draft"

# --- Classification Guide Rules ---

[[rules]]
id = "rule-guide-create"
feature_id = "feat-classification-guides"
role = "Platform Administrator"
requirement = "create classification guides with English descriptions for each sensitivity level"
reason = "help users correctly classify data"
status = "draft"

[[rules]]
id = "rule-guide-reference"
feature_id = "feat-classification-guides"
role = "Platform User"
requirement = "see which classification guides apply to a record's classification"
reason = "understand why data is classified at a particular level"
status = "draft"

[[rules]]
id = "rule-guide-tenant"
feature_id = "feat-classification-guides"
role = "Platform Administrator"
requirement = "include tenant-specific guidance in classification guides"
reason = "clarify when data should be compartmentalized"
status = "draft"

# --- ACO Modification Rules ---

[[rules]]
id = "rule-aco-modify-allowed"
feature_id = "feat-aco-modification"
role = "Platform User"
requirement = "modify the ACO of records I can access to other ACOs I would also be able to access"
reason = "adjust classification as data sensitivity changes"
status = "draft"

[[rules]]
id = "rule-aco-modify-log"
feature_id = "feat-aco-modification"
role = "Platform System"
requirement = "log all ACO modifications with before/after values"
reason = "track classification changes for audit"
status = "draft"

# ============================================================================
# SCENARIOS - Test cases for access control rules
# ============================================================================

# --- Default ACO Scenarios ---

[[scenarios]]
id = "scen-aco-default-create"
rule_id = "rule-aco-default"
name = "New record gets default ACO"
narrative = "Given I create a new personnel record, when I do not specify an ACO, then the record is saved with ACO {\"sensitivity\": \"low\"}"
status = "draft"

[[scenarios]]
id = "scen-aco-explicit-no-inherit"
rule_id = "rule-aco-explicit"
name = "Child records do not inherit parent ACO"
narrative = "Given a chat channel has ACO {\"sensitivity\": \"moderate\"}, when I send a message to that channel without specifying ACO, then the message gets the default ACO {\"sensitivity\": \"low\"}, not the channel's ACO"
status = "draft"

# --- Sensitivity Level Scenarios ---

[[scenarios]]
id = "scen-sensitivity-filter-list"
rule_id = "rule-sensitivity-view"
name = "List filtered by sensitivity"
narrative = "Given I have clearance 'moderate' and there are personnel records at public, low, moderate, and high sensitivity, when I list personnel, then I only see records with sensitivity public, low, or moderate"
status = "draft"

[[scenarios]]
id = "scen-sensitivity-block-detail"
rule_id = "rule-sensitivity-view"
name = "Cannot view high sensitivity record"
narrative = "Given I have clearance 'moderate' and a personnel record has sensitivity 'high', when I try to view that record by ID, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-sensitivity-create-blocked"
rule_id = "rule-sensitivity-create"
name = "Cannot create above clearance"
narrative = "Given I have clearance 'moderate', when I try to create a record with sensitivity 'high', then the creation fails with an access denied error"
status = "draft"

[[scenarios]]
id = "scen-sensitivity-badge"
rule_id = "rule-sensitivity-indicator"
name = "Sensitivity badge displayed"
narrative = "Given I am viewing a personnel detail panel, when the record has sensitivity 'moderate', then I see a visual badge indicating 'MODERATE' classification"
status = "draft"

# --- Tenant Access Scenarios ---

[[scenarios]]
id = "scen-tenant-single-access"
rule_id = "rule-tenant-access"
name = "Can access single tenant record"
narrative = "Given I have tenant access 'moderate:üçé' and a record has tenants ['üçé'] with sensitivity 'low', when I view the record, then I can see it"
status = "draft"

[[scenarios]]
id = "scen-tenant-single-blocked"
rule_id = "rule-tenant-access"
name = "Blocked without tenant access"
narrative = "Given I have no tenant access for üçé and a record has tenants ['üçé'], when I try to view the record, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-tenant-insufficient-level"
rule_id = "rule-tenant-access"
name = "Blocked with insufficient tenant level"
narrative = "Given I have tenant access 'low:üçé' and a record has tenants ['üçé'] with sensitivity 'moderate', when I try to view the record, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-tenant-multi-all"
rule_id = "rule-tenant-multi"
name = "Access requires all tenants"
narrative = "Given I have tenant access 'moderate:üçé' but not üçå and a record has tenants ['üçé', 'üçå'], when I try to view the record, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-tenant-emoji-display"
rule_id = "rule-tenant-indicator"
name = "Tenant emojis displayed"
narrative = "Given I am viewing a record with tenants ['üçé', 'üçå'], when I look at the record header, then I see the emojis üçéüçå displayed as tenant indicators"
status = "draft"

# --- Role Requirement Scenarios ---

[[scenarios]]
id = "scen-role-single-access"
rule_id = "rule-role-access"
name = "Can access with required role"
narrative = "Given I have role 'hr_viewer' and a record requires roles ['hr_viewer'], when I view the record, then I can see it"
status = "draft"

[[scenarios]]
id = "scen-role-single-blocked"
rule_id = "rule-role-access"
name = "Blocked without required role"
narrative = "Given I do not have role 'hr_viewer' and a record requires roles ['hr_viewer'], when I try to view the record, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-role-multi-partial"
rule_id = "rule-role-multi"
name = "Partial roles insufficient"
narrative = "Given I have role 'manager' but not 'hr_viewer' and a record requires roles ['manager', 'hr_viewer'], when I try to view the record, then I receive an access denied response"
status = "draft"

[[scenarios]]
id = "scen-role-global-admin-bypass"
rule_id = "rule-global-admin"
name = "Global admin bypasses all checks"
narrative = "Given I have role 'global_admin' and a record has sensitivity 'high', tenants ['üçé'], and roles ['secret_committee'], when I view the record, then I can see it regardless of my other attributes"
status = "draft"

# --- Access Logging Scenarios ---

[[scenarios]]
id = "scen-log-read-recorded"
rule_id = "rule-log-all-reads"
name = "Read operation logged"
narrative = "Given I view a personnel record, when the request completes, then an entry exists in the access log with my subject ID, the record ID, action 'read', and timestamp"
status = "draft"

[[scenarios]]
id = "scen-log-write-recorded"
rule_id = "rule-log-writes"
name = "Write operation logged with changes"
narrative = "Given I update a personnel record's title, when the request completes, then an entry exists in the access log with action 'update', old value, new value, and timestamp"
status = "draft"

[[scenarios]]
id = "scen-log-denial-recorded"
rule_id = "rule-log-denials"
name = "Access denial logged"
narrative = "Given I try to view a record I cannot access, when the request is denied, then an entry exists in the access log with action 'read', outcome 'denied', and the reason for denial"
status = "draft"

# --- Classification Guide Scenarios ---

[[scenarios]]
id = "scen-guide-create"
rule_id = "rule-guide-create"
name = "Create classification guide"
narrative = "Given I am a Global Administrator, when I create a classification guide with descriptions for each sensitivity level, then the guide is saved and available for reference"
status = "draft"

[[scenarios]]
id = "scen-guide-referenced"
rule_id = "rule-guide-reference"
name = "View classification guide reference"
narrative = "Given a record's SCO references classification guide 'CG-HR-001', when I view the record's security context, then I can see the guide ID and click to view its full content"
status = "draft"

# --- ACO Modification Scenarios ---

[[scenarios]]
id = "scen-aco-modify-within-clearance"
rule_id = "rule-aco-modify-allowed"
name = "Can modify ACO within clearance"
narrative = "Given I have clearance 'moderate' and a record has sensitivity 'low', when I change the sensitivity to 'moderate', then the change is saved successfully"
status = "draft"

[[scenarios]]
id = "scen-aco-modify-blocked"
rule_id = "rule-aco-modify-allowed"
name = "Cannot modify ACO beyond clearance"
narrative = "Given I have clearance 'moderate' and a record has sensitivity 'low', when I try to change the sensitivity to 'high', then the change is rejected with an access denied error"
status = "draft"

[[scenarios]]
id = "scen-aco-modify-logged"
rule_id = "rule-aco-modify-log"
name = "ACO modification logged"
narrative = "Given I modify a record's sensitivity from 'low' to 'moderate', when the change is saved, then an entry exists in the access log with action 'aco_modify', old ACO, new ACO, and my subject ID"
status = "draft"
